<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Login</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="login.css">
</head>
<body>
    <header>
        <div class="logo">üè® HMS Deluxe</div>
         <!-- ‚úÖ Back Button Added -->
        <button class="btn-back-home" onclick="window.location.href='index.html'">Back to Home</button>
    </header>

    <div class="container" style="justify-content: center;">
        <div class="action-hub" style="width: 400px; padding: 40px;">
            <h3>User Login</h3>

            <!-- ‚≠ê UPDATED: JS handles login -->
            <form id="loginForm" onsubmit="return loginUser(event)">
                <input type="text" name="username" placeholder="User Name" required>
                <div class="password-container">
                  <input type="password" id="login_password" name="password" placeholder="Password" required>
                  <i class="fa-solid fa-eye togglePassword" onclick="toggleLoginPass(this)"></i>
                </div>
                <button type="submit" class="btn-user-login">Login</button>
            </form>
            <!-- Google Login Button -->
                <button id="googleLogin" class="btn-user-login" style="background:#DB4437; margin-top:10px;">
                <i class="fa-brands fa-google"></i> Login with Google</button>
                <button onclick="facebookLogin()" class="btn-user-register" style="background:#1877F2; color:white; margin-top:10px;">
                <i class="fa-brands fa-facebook"></i> Login with Facebook</button>
            
            <p style="margin-top: 15px;">Don't have an account? <a href="register.html">Register Here</a></p>
            <p style="margin-top: 15px;">Forgot Password? <a href="forgot.html">Forgot Password</a></p>
        </div>
    </div>
    
    <footer>&copy; 2025 HMS Deluxe. All rights reserved.</footer>

    <!-- Load Google SDK -->
<script src="https://accounts.google.com/gsi/client"></script>

<script>
const GOOGLE_CLIENT_ID = "322209546870-bjkc4hg3blsr7mtbe47rsc10dbs33lv1.apps.googleusercontent.com";

google.accounts.id.initialize({
    client_id: GOOGLE_CLIENT_ID,
    callback: handleGoogleResponse
});

document.getElementById("googleLogin").onclick = () => {
    google.accounts.id.prompt();
};

async function handleGoogleResponse(response) {
    try {
        const res = await fetch("https://hms1-181v.onrender.com/google-login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ credential: response.credential })
        });

        const data = await res.json();

        if (data.success) {
            localStorage.setItem("guestUsername", data.username);
            alert("Login Successful!");
            window.location.href = "userhome.html";
        } else {
            alert("Google Login Failed");
        }
    } catch (err) {
        alert("Server Error");
    }
}
</script>

    <script>
        // FULL NAME: Allow only A-Z and a-z (case-sensitive)
        document.querySelector("input[name='username']").addEventListener("keypress", function (e) {
            const char = String.fromCharCode(e.which);

            // Allow only letters and space
            if (!/^[A-Za-z ]$/.test(char)) {
                e.preventDefault(); // block input
            }
        });

        // Also block pasted numbers/symbols
        document.querySelector("input[name='username']").addEventListener("input", function () {
            this.value = this.value.replace(/[^A-Za-z ]/g, "");
        });

        /* ‚≠êLOGIN FUNCTION ‚Äî Connect to Node.js backend */
        async function loginUser(event) {
            event.preventDefault();

            const username = document.querySelector("input[name='username']").value;
            const password = document.querySelector("input[name='password']").value;

            try {
                const response = await fetch("https://hms1-181v.onrender.com/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username, password })
                });

                const result = await response.json();

                if (result.success) {
                    alert("Login Successful!");
                    // ‚≠ê Save username for dashboard
                    localStorage.setItem("guestUsername", username);
                    window.location.href = "userhome.html"; // redirect to user dashboard
                } else {
                    alert("Error: " + result.message);
                }

            } catch (error) {
                alert("Failed to connect to server!");
            }
        }

        function toggleLoginPass(icon) {
          const field = document.getElementById("login_password");

          if (field.type === "password") {
            field.type = "text";
            icon.classList.remove("fa-eye");
            icon.classList.add("fa-eye-slash");
          } else {
            field.type = "password";
            icon.classList.remove("fa-eye-slash");
            icon.classList.add("fa-eye");
          }
        }
    </script>

    <script>
function facebookLogin() {
    window.location.href = "https://hms1-181v.onrender.com/auth/facebook";
}
</script>

</body>
</html>
